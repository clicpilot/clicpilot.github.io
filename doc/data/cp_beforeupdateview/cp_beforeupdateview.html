<!DOCTYPE html>
<html lang="en">
<head>
	<title>Create Action</title>
</head>
<body>
	<h4>Create Item</h4>
	<form class="cp-create" cp-entity-name="Item" cp-action-name="CreateItem">
		<label>Item</label><p>
		<input id="ItemName" type="text" class="cp-string" cp-prop-name="Name" value=""></input>
		<button type="button" class="cp-submit">Create</button>
	</form>

	<h4>Items</h4>
	<button type="button" onclick="javascript:CP_UpdateView('QueryItem')">Refresh</button>
	<ul class="cp-query" cp-entity-name="Item" cp-action-name="QueryItem" cp-field="['ItemId','Name']">
		<li>
		  <span>{{=it.ItemId}}</span>
		  <a class="cp-string" href="#" cp-prop-name="Name" onclick="javascript:CP_UpdateView('UpdateItem', {Id: {{=it.ItemId}} } )">{{=it.Name}}</a>
		</li>
	</ul>
	<pre id="msg"></pre>
	<pre id="log"></pre>
	<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://clicpilot.github.io/clicpilot-js-current.js" class="clicpilot-js"></script>
    <script>
    CP_Init(function(){
    	$("#msg").append("Page loaded!");
    	$("#ItemName").val("Item 1");
    	CP_DoAction("CreateItem", {});
    	$("#ItemName").val("Item 2");
    	CP_DoAction("CreateItem", {});
    	$("#ItemName").val("Item 3");
    	CP_DoAction("CreateItem", {});
    	
    });
    CP_AfterUpdateView("QueryItem", function(param){
    	$("#log").append("QueryItem view refreshed\n");
    });
    CP_BeforeUpdateView("QueryItem", function(param){
    	$("#log").append("QueryItem view is going to be refreshed\n");
    });
   	window.ShowResponse = function(msg) {
	    $("#msg").text(msg);
	}
	window.ShowActionMsg = window.ShowResponse;
	window.ShowMessage = window.ShowResponse;
    </script>
</body>
</html>